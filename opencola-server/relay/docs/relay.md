# OC Relay

## State

| State       | Description                                                                   |
|-------------|-------------------------------------------------------------------------------|
| Initialized | The client / server has been created, but is not ready to handle connections. |
| Opening     | The client / server is in the process of getting ready to handle connections. |
| Open        | The client / server is open connection and ready to handle connections.       |
| Closed      | The client / server has been closed connection.                               |

## Connection

A ```Connection``` is a thin wrapper around socket that allows messages to be 
passed between the ```Server``` and ```Client```s. ```Connection```s only 
know how to pass byte arrays around. A ```MessageHandler``` 
(of type ```suspend (ByteArray) -> Unit``` ) is registered, via the 
```listen``` method, that handles incoming messages. 

### Message

The relay client and server use ```Conntection```s to pass ```Message```s, which 
have the following fields 

| Field  | Type         | Description                                    |
|--------|--------------|------------------------------------------------|
| header | ```Header``` | A header containing metadata about the message |
| body   | ```bytes```  | An arbitrary byte array.                       |

### Header

Headers contain metadata about the message. To is not included in this metadata, is it is 
available in the outer envelope of the message.

| Field     | Type            | Description                                                                                             |
|-----------|-----------------|---------------------------------------------------------------------------------------------------------|
| from      | PublicKey       | The public key of the sender of the message.                                                            |
| messageId | UUID            | A unique identifier for the message.                                                                    |
| signature | ```Signature``` | A signature of the message body. The signature is generated by the sender and verified by the receiver. |

### Signature
| Field     | Type         | Description                                   |
|-----------|--------------|-----------------------------------------------|
| algorithm | ```String``` | The algorithm used to generate the signature. |
| bytes     | ```bytes```  | The signature of the message body.            |

### Envelope

| Field   | Type            | Description                                                                                                                                                                                                                                                                      |
|---------|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| to      | ```PublicKey``` | The public key of the recipient of the message.                                                                                                                                                                                                                                  |
| key     | ```bytes```     | **V2 ONLY**: The key (typically the hash of some / all of the message data before encryption) used to control message storage. When not present, the message is considered transient and will **NOT** be stored. When present, only 1 ```Message``` with the same key is stored. |
| message | ```bytes```     | The message to be sent.                                                                                                                                                                                                                                                          |






