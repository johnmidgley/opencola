<img src="../img/pull-tab.svg" width="150" alt="OpenCola"/>

# web-ui

This directory contains the web interface for the collaboration tool. It is written in [ClojureScript](https://clojurescript.org/) using [Reagent](https://reagent-project.github.io/) with [Leiningen](https://leiningen.org/) and [Figwheel](https://figwheel.org/) tooling.

## Setup

In order edit the UI, you will need to install [Clojure](https://clojure.org/guides/getting_started), which on MacOS is:

```bash
brew install clojure/tools/clojure
```

> If you're unfamiliar with Clojure and want to learn the basics, follow the [quick start](https://clojurescript.org/guides/quick-start).

Install [Leiningen](https://leiningen.org/), which automates Clojure builds"

```bash
brew install leiningen
```

## Developing

[Figwheel](https://figwheel.org/) provides a dynamic way of building Clojurescript applications, where the UI is updated whenever the source code is saved.

Before starting the `web-ui`, make sure that the API [server](../opencola-server/server/README.md) is running. Since the figwheel server and the backend server are running on different ports, you will need to disable authentication so that the login flow doesn't try to breakout of figwheel. You can do this by editing your `opencola-server.yaml` file or setting the following environment variables:

```bash
security.login.password=test # Change this if you have already set a password
security.login.authenticationRequired=false
```

Once the server is running, in another command line window, start Figwheel for development with

```bash
lein fig:build 
```

This may take a bit to get everything running, but when done, it will start a repl and a web session in your default browser.

You can test the repl / browser connection by typing:

```bash
cljs.user=> (js/alert "Am I connected?")
```

This should cause a pop-up to appear in the browser.

>Figwheel is generally very good at updating any code in the browser when the source is saved. Occasionally, things can get missed. If you ever don't see an expected change in the UI, try doing a forced refresh in the browser (holding SHIFT and clicking the refresh button works in most browsers).

The source code (in [`src/opencola`](./src/opencola/)) has the following structure:

|Directory|Description|
|---------|-----------|
|model| Functions for interacting with the server. |
|view| UI components|
|.|Other code common to different views|

The entry point for the code is [`web_ui.cljs`](./src/opencola/web_ui.cljs)

## Deploying

Any edits you make to source code in the `web-ui` directory don't affect the server until they are deployed (copied into the server resources). To do this, you'll want to create a clean, minimized build and the deploy it, which is done with the deploy script:

```bash
./deploy
```

## Themes

Making themes for OpenCola is quite easy. There are two themes generated by default (Light and dark) others can be easily created by adding to the `themes.json` file found in the opencola ***storage*** directory. See [server](../opencola-server/server/README.md) for details on where this is located by default on your system.

The basic structure of the themes file is a list of objects with a `name` and `style-attributes` key.

The `name` key, unsurprisingly, represents the name of the theme that will appear in the application.

The `style-attributes` key maps to an object used to style the application.

Within the `style-attributes` object, the key names are the names of pre-defined css variables. The values are realistically any valid CSS text, which means what you can very effectively break stuff! But also that you can insert potentially complicated colors as well. Anything from `black` to whatever obscure linear gradient your heart desires (there's an example of that later).

### Example themes file

```json
[
    {
        "name": "Dark",
        "style-attributes": {
            "--primary-color": "rgb(12, 11, 11)",
            "--secondary-color": "rgb(39, 36, 36)",
            "--tertiary-color": "rgb(114, 114, 114)",
            "--accent-color": "rgb(221, 221, 221)",
            "--highlight-color": "rgb(255, 0, 0)",
            "--shadow-color":"rgb(29, 28, 28)",
            "--link-color": "rgb(51, 94, 204)",
            "--muted-color": "rgb(114, 114, 114)",
            "--contrast-color": "rgb(255, 255, 255)"
        }
    }
]
```

Within the `style-attributes` object there are two helpful categories of key names.

Below are the general attributes:

|Field Name|Type|
|----------|----|
|--primary-color|string|
|--secondary-color|string|
|--tertiary-color|string|
|--accent-color|string|
|--highlight-color|string|
|--contrast-color|string|
|--muted-color|string|
|--caution-color|string|
|--disabled-color|string|
|--shadow-color|string|

modifying these attributes is all that is needed, generally, to create a coherent theme. They will affect many parts of the applications appearance at once.

If more specific control is wanted, there is a list of granular attributes which affect specific portions of the application. If these key names do not appear in the theme file, within the application, these fields will be filled using the default values mentioned in the table below (for example if --text-color is left untouched it will be filled by --accent-color)

|Field Name|Type|Default Value|
|----------|----|-------------|
|--text-color|string|--accent-color|
|--text-color-contrast|string|--primary-color|
|--app-background-color|string|--primary-color|
|--item-bg-color|string|--primary-color|
|--item-body-bg-color|string|--secondary-color|
|--item-attribution-color|string|--muted-color|
|--comment-bg-color|string|--secondary-color|
|--comment-text-color|string|--text-color|
|--own-comment-bg-color|string|--secondary-color|
|--tag-bg-color:|string|--secondary-color|
|--tag-text-color|string|--text-color|
|--link-color|string|rgb(50, 72, 195)|
|--action-highlight-color|string|--highlight-color|
|--border-color|string|--tertiary-color|
|--border-size|numeric|1px|
|--icon-color|string|--tertiary-color|
|--button-bg-color|string|--primary-color|
|--button-hover-bg-color|string|--accent-color|
|--tooltip-bg-color|string|--secondary-color|
|--tooltip-text-color|string|--text-color|
|--caret-color|string|--contrast-color|

### Adding A Theme

Adding a theme is easy, just add a new abject to the list in the themes file:

```json
[
    {
        "name": "Light",
        "style-attributes": {
            "--primary-color": "rgb(255, 255, 255)",
            "--secondary-color": "rgb(239, 239, 239)",
            "--tertiary-color": "rgb(0, 0, 0)",
            "--accent-color": "rgb(0, 0, 0)",
            "--highlight-color": "rgb(255, 0, 0)",
            "--shadow-color":"rgb(232, 232, 232)",
            "--link-color": "rgb(50, 72, 195)",
            "--muted-color": "rgb(170, 170, 170)",
            "--contrast-color": "rgb(0, 0, 0)"
        }
    },
    {
        "name": "Unicorn Barf",
        "style-attributes": {
            "--primary-color": "rgb(244, 148, 253)",
            "--secondary-color": "rgb(140, 0, 255)",
            "--tertiary-color": "rgb(0, 255, 247)",
            "--accent-color": "rgb(255, 255, 255)",
            "--highlight-color": "rgb(255, 0, 119)",
            "--contrast-color": "rgb(0, 0, 0)",
            "--caution-color": "red",
            "--disabled-color": "rgb(207, 207, 207)",
            "--shadow-color": "rgb(255, 255, 255)",
            "--item-bg-color": "linear-gradient(180deg,rgba(255, 0, 0, 1) 0%,rgba(255, 154, 0, 1) 10%,rgba(208, 222, 33, 1) 20%,rgba(79, 220, 74, 1) 30%,rgba(63, 218, 216, 1) 40%,rgba(47, 201, 226, 1) 50%,rgba(28, 127, 238, 1) 60%,rgba(95, 21, 242, 1) 70%,rgba(186, 12, 248, 1) 80%,rgba(251, 7, 217, 1) 90%,rgba(255, 0, 0, 1) 100%)"
        }
    }
]
```

This example helps illustrate what sorts of values can be used in the themes file.
