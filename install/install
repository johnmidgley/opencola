#!/bin/bash
echo "Removing old dist"
rm -rf opencola
mkdir opencola

echo "Running gradle installDist"
cd ../opencola-server
gradlew installDist

echo "Copying distribution"
cd ../install/opencola
cp ../run .
mkdir server
cp -r ../../opencola-server/build/install/opencola-server/* server

echo "Copying config"
cp ../../opencola-server/opencola-server.yaml server
mkdir oc-network
cp ../../network/docker-compose.yml oc-network

echo "Copying resources"
mkdir server/resources
cp -r ../../opencola-server/resources/ server/resources/

echo "Copying Chrome extension"
cp -r  ../../extension/chrome .

if [ -d "storage" ]; 
then
echo "Storage already exists" 
else
echo "Creating storage"
mkdir -p storage/var-solr/data
cp ../../storage/var-solr/log4j2.xml storage/var-solr/
cp -r ../../storage/var-solr/data/configsets/ storage/var-solr/data/configsets
cp ../../storage/var-solr/data/solr.xml storage/var-solr/data/
cp ../../storage/var-solr/data/zoo.cfg storage/var-solr/data/
fi

